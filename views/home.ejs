<% /* views/home.ejs */ %>
<% title = 'Panel Principal' %>

<%
  const shadows = ['shadow-offset-coral','shadow-offset-menta','shadow-offset-mostaza'];
  const items = [
    { url: '/clientes',           icon: 'bi-people-fill',       title: 'Clientes',           text: 'Gestiona tu lista' },
    { url: '/clientes/nuevo',     icon: 'bi-person-plus',       title: 'Nuevo Cliente',      text: 'Agrega un contacto' },
    { url: '/pedidos/nuevo',      icon: 'bi-bag-plus-fill',     title: 'Nuevo Pedido',       text: 'Crea un encargo' },
    { url: '/pedidos/pendientes', icon: 'bi-hourglass-split',   title: 'Trabajos Encargados',text: 'Revisa en curso',     countKey: 'pendientes' },
    { url: '/pedidos/revision',   icon: 'bi-search-heart-fill', title: 'En Revisión',        text: 'Corrige pedidos',     countKey: 'revision' },
    { url: '/pedidos/impresiones',icon: 'bi-printer-fill',      title: 'Para Imprimir',      text: 'Descarga finales',    countKey: 'impresion' },
    { url: '/pedidos/terminados', icon: 'bi-check2-all',        title: 'Terminados',         text: 'Listos para entrega', countKey: 'terminados' },
    { url: '/pedidos/entregados', icon: 'bi-box-arrow-in-right',title: 'Entregados',         text: 'Historial entregas',  countKey: 'entregados' },
    { url: '/pedidos/historial',  icon: 'bi-clock-history',     title: 'Historial',          text: 'Repite antiguos' }
  ];
%>

<style>
  .counter-circle {
    position: absolute;
    top: 8px;
    right: 8px;
    background: crimson;
    color: #fff;
    font-size: 0.75rem;
    font-weight: bold;
    border-radius: 50%;
    width: 26px;
    height: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
</style>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 my-4">
  <% items.forEach((item, i) => { %>
    <div class="col">
      <a href="<%= item.url %>" class="text-decoration-none position-relative">
        <div class="card h-100 retro-card <%= shadows[i % shadows.length] %>">
          <div class="card-body d-flex flex-column align-items-center position-relative">
            <% if (item.countKey && counts?.[item.countKey] > 0) { %>
              <div class="counter-circle"><%= counts[item.countKey] %></div>
            <% } %>
            <i class="bi <%= item.icon %> display-4 mb-3" aria-hidden="true"></i>
            <h5 class="card-title"><%= item.title %></h5>
            <p class="card-text text-center"><%= item.text %></p>
            <span class="btn btn-outline-dark mt-auto">Ver</span>
          </div>
        </div>
      </a>
    </div>
  <% }) %>
</div>

<% if (user && user.rol === 'Admin') { %>
  <a href="/usuarios" class="btn btn-dark">⚙️ Gestión de Usuarios</a>
<% } %>
